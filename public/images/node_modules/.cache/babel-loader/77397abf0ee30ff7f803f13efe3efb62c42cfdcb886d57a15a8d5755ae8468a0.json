{"ast":null,"code":"import{useEffect,useState,useContext,useCallback}from'react';import ProductCard from'../components/ProductCard';import{Row,Col,Form,Button}from'react-bootstrap';import{Link}from'react-router-dom';import UserContext from'../context/UserContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Products(){const{user}=useContext(UserContext);const[products,setProducts]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[error,setError]=useState('');const[isArchivedView,setIsArchivedView]=useState(false);// New state to toggle views\nconst fetchData=useCallback(()=>{const fetchUrl=isArchivedView?\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/products/archive\"):\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/products/active\");fetch(fetchUrl,{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token'))}}).then(res=>{if(!res.ok)throw new Error('Failed to fetch products');return res.json();}).then(data=>{setProducts(data);setError('');// Clear previous error\n}).catch(err=>setError(err.message));},[isArchivedView]);useEffect(()=>{if(searchTerm.trim()===''){fetchData();// Fetch all archived products if search term is empty\n}},[searchTerm,fetchData]);const handleToggle=id=>{setProducts(prevProducts=>prevProducts.filter(product=>product._id!==id));};const handleSearch=event=>{event.preventDefault();const fetchUrl=\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/products/search-by-name\");fetch(fetchUrl,{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({productName:searchTerm,isActive:!isArchivedView})// Use isActive based on view type\n}).then(res=>{if(!res.ok){if(res.status===404){setProducts([]);setError('No products found');}else{throw new Error(\"Failed to search products\");}}return res.json();}).then(data=>{if(data&&data.products){setProducts(data.products);setError('');}}).catch(err=>{setError(err.message);setProducts([]);});};return/*#__PURE__*/_jsx(_Fragment,{children:user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Row,{className:\"mt-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12 d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Products Catalog\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex search-con\",children:[user.isAdmin&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>setIsArchivedView(prev=>!prev),className:\"ml-1 \".concat(isArchivedView?'active':''),children:isArchivedView?'View Active':'View Archived'}),/*#__PURE__*/_jsx(Link,{className:\"btn btn-primary ml-1\",to:\"/addProduct\",children:\"Add Product\"})]}),/*#__PURE__*/_jsx(Form,{onChange:handleSearch,children:/*#__PURE__*/_jsx(Form.Group,{controlId:\"search\",children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Search Product List\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})})})]})]})}),/*#__PURE__*/_jsx(Row,{children:products.length>0?products.map(product=>/*#__PURE__*/_jsx(Col,{md:3,className:\"mb-4\",children:/*#__PURE__*/_jsx(ProductCard,{productProp:product,onToggle:handleToggle})},product._id)):/*#__PURE__*/_jsx(Col,{md:12,children:/*#__PURE__*/_jsx(\"h4\",{children:error||'No products available'})})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"You are not logged in\"}),/*#__PURE__*/_jsx(Link,{className:\"btn btn-primary\",to:\"/login\",children:\"Login to View\"})]})});}","map":{"version":3,"names":["useEffect","useState","useContext","useCallback","ProductCard","Row","Col","Form","Button","Link","UserContext","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Products","user","products","setProducts","searchTerm","setSearchTerm","error","setError","isArchivedView","setIsArchivedView","fetchData","fetchUrl","concat","process","env","REACT_APP_API_BASE_URL","fetch","headers","Authorization","localStorage","getItem","then","res","ok","Error","json","data","catch","err","message","trim","handleToggle","id","prevProducts","filter","product","_id","handleSearch","event","preventDefault","method","body","JSON","stringify","productName","isActive","status","children","className","isAdmin","variant","onClick","prev","to","onChange","Group","controlId","Control","type","placeholder","value","e","target","length","map","md","productProp","onToggle"],"sources":["D:/ZUITT/B443/b443-csp3-fataek-lim/src/pages/Products.js"],"sourcesContent":["import { useEffect, useState, useContext, useCallback } from 'react';\nimport ProductCard from '../components/ProductCard';\nimport { Row, Col, Form, Button } from 'react-bootstrap';\nimport { Link } from 'react-router-dom';\nimport UserContext from '../context/UserContext';\n\nexport default function Products() {\n    const { user } = useContext(UserContext);\n    const [products, setProducts] = useState([]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [error, setError] = useState('');\n    const [isArchivedView, setIsArchivedView] = useState(false); // New state to toggle views\n\n    const fetchData = useCallback(() => {\n        const fetchUrl = isArchivedView \n            ? `${process.env.REACT_APP_API_BASE_URL}/products/archive`\n            : `${process.env.REACT_APP_API_BASE_URL}/products/active`;\n\n        fetch(fetchUrl, {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            }\n        })\n        .then(res => {\n            if (!res.ok) throw new Error('Failed to fetch products');\n            return res.json();\n        })\n        .then(data => {\n            setProducts(data);\n            setError(''); // Clear previous error\n        })\n        .catch(err => setError(err.message));\n    }, [isArchivedView]);\n\n    useEffect(() => {\n        if (searchTerm.trim() === '') {\n            fetchData(); // Fetch all archived products if search term is empty\n        }\n    }, [searchTerm, fetchData]);\n\n    const handleToggle = (id) => {\n        setProducts(prevProducts => prevProducts.filter(product => product._id !== id));\n    }\n\n    const handleSearch = (event) => {\n        event.preventDefault();\n        const fetchUrl = `${process.env.REACT_APP_API_BASE_URL}/products/search-by-name`;\n\n        fetch(fetchUrl, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                Authorization: `Bearer ${localStorage.getItem('token')}`\n            },\n            body: JSON.stringify({ productName: searchTerm, isActive: !isArchivedView }) // Use isActive based on view type\n        })\n        .then(res => {\n            if (!res.ok) {\n                if (res.status === 404) {\n                    setProducts([]);\n                    setError('No products found');\n                } else {\n                    throw new Error(\"Failed to search products\");\n                }\n            }\n            return res.json();\n        })\n        .then(data => {\n            if (data && data.products) {\n                setProducts(data.products);\n                setError('');\n            }\n        })\n        .catch(err => {\n            setError(err.message);\n            setProducts([]);\n        });\n    }\n\n    return (\n        <>\n            {user ? (\n                <>  \n                    <Row className=\"mt-3\">\n                        <div className=\"col-md-12 d-flex justify-content-between align-items-center\">\n                            <h1>Products Catalog</h1>\n                            <div className=\"d-flex search-con\">\n                                {user.isAdmin && (\n                                    <div>\n                                        <Button\n                                            variant=\"primary\"\n                                            onClick={() => setIsArchivedView(prev => !prev)}\n                                            className={`ml-1 ${isArchivedView ? 'active' : ''}`}\n                                        >\n                                            {isArchivedView ? 'View Active' : 'View Archived'}\n                                        </Button>\n                                        <Link className=\"btn btn-primary ml-1\" to={\"/addProduct\"}>Add Product</Link>\n                                    </div>\n                                )}\n                                <Form onChange={handleSearch}>\n                                    <Form.Group controlId=\"search\">\n                                        <Form.Control\n                                            type=\"text\"\n                                            placeholder=\"Search Product List\"\n                                            value={searchTerm}\n                                            onChange={(e) => setSearchTerm(e.target.value)}\n                                        />\n                                    </Form.Group>\n                                </Form>\n                            </div>\n                        </div>\n                    </Row>\n                    <Row>\n                        {products.length > 0 ? (\n                            products.map(product => (\n                                <Col md={3} key={product._id} className=\"mb-4\">\n                                    <ProductCard \n                                        productProp={product} \n                                        onToggle={handleToggle}\n                                    />\n                                </Col>\n                            ))\n                        ) : (\n                            <Col md={12}>\n                                <h4>{error || 'No products available'}</h4>\n                            </Col>\n                        )}\n                    </Row>\n                </>\n            ) : (\n                <>\n                    <h1>You are not logged in</h1>\n                    <Link className=\"btn btn-primary\" to={\"/login\"}>Login to View</Link>\n                </>\n            )}\n        </>\n    );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}